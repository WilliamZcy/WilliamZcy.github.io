<!DOCTYPE html>
<html>
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    
    <title>Python 利用GDAL对图像进行几何校正 | Rhapsody | 不积跬步，无以至千里</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="GDAL,Python">
    <link rel="shortcut icon" href="/img/earth.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.css" />
    <link rel="stylesheet" href="/css/style.css?v=1.3.2">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":true,"app_id":"NKjKG1V8rXwbFEGNgOaAsT69-gzGzoHsz","app_key":"AxuIJ3XB4NNfoTdmyUviWVGw","icon":true}'),
            v: JSON.parse('{"enable":true,"appid":"NKjKG1V8rXwbFEGNgOaAsT69-gzGzoHsz","appkey":"AxuIJ3XB4NNfoTdmyUviWVGw","notify":false,"verify":true,"placeholder":"请留下建议或疑问......PS.可填写邮箱便于通知回复","avatar":"identicon"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"544032960@qq.com","repo":"comments","oauth":{"client_id":"9dd91e59897ce58abc65","client_secret":"45f2d5d4532c1be548a245a6eb1c448b1e145115"},"perPage":5}'),
            d: JSON.parse('{"app_id":"bae606f1"}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
        <script type="text/javascript" src="/js/plugins/daovoice.js?v=1.3.2"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
</head>


<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand2.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/face.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">可乐&Mentos</h5>
          <a href="mailto:Zhucy@s.upc.edu.cn" title="Zhucy@s.upc.edu.cn" class="mail">
            
              <span>Z</span>
            
              <span>h</span>
            
              <span>u</span>
            
              <span>c</span>
            
              <span>y</span>
            
              <span>@</span>
            
              <span>s</span>
            
              <span>.</span>
            
              <span>u</span>
            
              <span>p</span>
            
              <span>c</span>
            
              <span>.</span>
            
              <span>e</span>
            
              <span>d</span>
            
              <span>u</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>n</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/WilliamZcy" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="">
              <a href="/timeaixs"  >
                <i class="icon icon-lg icon-clock-o"></i>
                时间轴
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Python 利用GDAL对图像进行几何校正</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/wave2.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">Python 利用GDAL对图像进行几何校正</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-07-16T12:09:35.000Z" itemprop="datePublished" class="page-time">
  2018-07-16
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Experiences/">Experiences</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-Python-利用GDAL对图像进行几何校正"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Python 利用GDAL对图像进行几何校正</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-07-16 20:09:35" datetime="2018-07-16T12:09:35.000Z"  itemprop="datePublished">2018-07-16</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Experiences/">Experiences</a></li></ul>



            
	<span id="/post/edf42ac0.html" class="leancloud_visitors" data-flag-title="Python 利用GDAL对图像进行几何校正" title="Python 利用GDAL对图像进行几何校正">
		
			<i class="icon icon-eye"></i>
		
		<span class="leancloud-visitors-count"></span>
	</span>
 

            
    <span class="leancloud-comment">
        <i class="icon icon-comment-o"></i>
        <a href="/post/edf42ac0.html#comment">
            <span class="valine-comment-count" data-xid="/post/edf42ac0.html"></span>
        </a>
    </span>



            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <blockquote>
<p>If the implementation is hard to explain, it’s a bad idea.<br>If the implementation is easy to explain, it may be a good idea.<br>——The Zen of python</p>
</blockquote>
<hr>
<p>最近需要利用Python的GDAL库对遥感图像进行几何校正，在网上搜了搜相关资料，大部分是来自李民录老师的《GDAL源码剖析与开发指南》及其博客的C++代码，关于Python的资料较少，于是便四处参考查阅，最终实现了校正功能，现总结整理一下，如果有任何意见建议，欢迎批评指正。<br><a id="more"></a></p>
<h2 id="一、几何校正方法"><a href="#一、几何校正方法" class="headerlink" title="一、几何校正方法"></a>一、几何校正方法</h2><p>&emsp;&emsp;图像校正本质是建立一种从原始图像行列号到某种投影的数学关系，即实现图像行列坐标到投影坐标的转换。不同的校正方法利用了不同的方法来表示转换关系，但本质上式相同的。常用的几何校正方法包括：几何多项式校正、有理函数模型校正、局部区域校正模型、地理查找表校正等。<br>&emsp;&emsp;GDAL库中可以实现的校正方法就包括以上四种方法，即：<strong>1~3次的几何多项式校正</strong>、<strong>RPC（有理函数系数）校正</strong>、<strong>TPS（薄板样条）校正</strong>、<strong>GeoLoc校正</strong>。<em>[1]</em></p>
<h2 id="二、转换关系的描述"><a href="#二、转换关系的描述" class="headerlink" title="二、转换关系的描述"></a>二、转换关系的描述</h2><p>&emsp;&emsp;不同的校正方法需要的信息也不相同，通常我们采用地面控制点（GCPs）的方式来建立转换关系，如果是RPC校正，则需要RPC文件来提供RPC系数。有的卫星数据，例如MODIS是包含GeoLocation Arrays提供每个像素的经纬度，例如Himawari-8卫星数据则直接提供了投影和地理变换参数(仿射变换六参数<em>[2]</em>，这个最简单)。</p>
<h2 id="三、Python中的GDAL几何校正"><a href="#三、Python中的GDAL几何校正" class="headerlink" title="三、Python中的GDAL几何校正"></a>三、Python中的GDAL几何校正</h2><p>&emsp;&emsp;Python中的几何校正主要靠 <code>gdal.Warp()</code> 函数来实现的，下面说一下主要流程：</p>
<h3 id="1-读取未经校正的图像"><a href="#1-读取未经校正的图像" class="headerlink" title="1.读取未经校正的图像"></a>1.读取未经校正的图像</h3><p>&emsp;&emsp;主要利用 <code>gdal.Open()</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> osgeo <span class="keyword">import</span> gdal</span><br><span class="line"><span class="keyword">from</span> osgeo <span class="keyword">import</span> osr</span><br><span class="line"></span><br><span class="line">dataset = gdal.Open(<span class="string">r'xxx.tif'</span>, gdal.GA_Update)</span><br></pre></td></tr></table></figure>
<h3 id="2-构造地面控制点"><a href="#2-构造地面控制点" class="headerlink" title="2.构造地面控制点"></a>2.构造地面控制点</h3><p>&emsp;&emsp;构造控制点列表 <code>gcps_list</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实际控制点肯定要多的多，这里只写了四个点.</span></span><br><span class="line">gcps_list = [gdal.GCP(<span class="number">-111.931075</span>, <span class="number">41.745836</span>, <span class="number">0</span>, <span class="number">1078</span>, <span class="number">648</span>),</span><br><span class="line">			 gdal.GCP(<span class="number">-111.901655</span>, <span class="number">41.749269</span>, <span class="number">0</span>, <span class="number">3531</span>, <span class="number">295</span>),</span><br><span class="line">			 gdal.GCP(<span class="number">-111.899180</span>, <span class="number">41.739882</span>, <span class="number">0</span>, <span class="number">3722</span>, <span class="number">1334</span>),</span><br><span class="line">			 gdal.GCP(<span class="number">-111.930510</span>, <span class="number">41.728719</span>, <span class="number">0</span>, <span class="number">1102</span>, <span class="number">2548</span>)]</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;附控制点构造函数<code>gdal.GCP()</code>的说明<em>[3]</em>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gdal.GCP([x], [y], [z], [pixel], [line], [info], [id])</span><br><span class="line"><span class="comment"># x、y、z是控制点对应的投影坐标，默认为0;</span></span><br><span class="line"><span class="comment"># pixel、line是控制点在图像上的列、行位置，默认为0;</span></span><br><span class="line"><span class="comment"># info、id是用于说明控制点的描述和点号的可选字符串，默认为空.</span></span><br></pre></td></tr></table></figure>
<h3 id="3-添加地面控制点到图像"><a href="#3-添加地面控制点到图像" class="headerlink" title="3.添加地面控制点到图像"></a>3.添加地面控制点到图像</h3><p>&emsp;&emsp;在添加之前需要指定一个空间参考，这里以WGS84基准的地理坐标系(经纬度)为例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sr = osr.SpatialReference()</span><br><span class="line">sr.SetWellKnownGeogCS(<span class="string">'WGS84'</span>)</span><br><span class="line"><span class="comment"># 添加控制点</span></span><br><span class="line">dataset.SetGCPs(gcps, sr.ExportToWkt())</span><br></pre></td></tr></table></figure>
<h3 id="4-进行校正"><a href="#4-进行校正" class="headerlink" title="4.进行校正"></a>4.进行校正</h3><p>&emsp;&emsp;校正就直接调用<code>gdal.Warp()</code>就可以了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tps校正 重采样:最邻近法</span></span><br><span class="line">dst_ds = gdal.Warp(<span class="string">r'xxx_dst.tif'</span>, dataset, format=<span class="string">'GTiff'</span>, tps=<span class="keyword">True</span>,</span><br><span class="line">				   xRes=<span class="number">0.05</span>, yRes=<span class="number">0.05</span>, dstNodata=<span class="number">65535</span>, srcNodata=<span class="number">65535</span>,</span><br><span class="line">				   resampleAlg=gdal.GRIORA_NearestNeighbour， outputType=gdal.GDT_Int32)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;附<code>gdal.Warp()</code>的参数说明<em>[4]</em>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">gdal.Warp(destNameOrDestDS, srcDSOrSrcDSTab, **kwargs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># destNameOrDestDS --- 输出数据集路径或对象</span></span><br><span class="line"><span class="comment"># srcDSOrSrcDSTab --- 数据集对象或文件名or数据集对象或文件名的数组</span></span><br><span class="line"><span class="comment"># 关键字参数是gdal.WarpOptions()的返回值，或者直接定义gdal.WarpOptions()</span></span><br><span class="line"></span><br><span class="line">gdal.WarpOptions(options = [], format = <span class="string">'GTiff'</span>, outputBounds = <span class="keyword">None</span>,</span><br><span class="line">				 outputBoundsSRS = one, xRes = <span class="keyword">None</span>, yRes = <span class="keyword">None</span>,</span><br><span class="line">				 targetAlignedPixels = <span class="keyword">False</span>, width = <span class="number">0</span>, height = <span class="number">0</span>, srcSRS = <span class="keyword">None</span>,</span><br><span class="line">				 dstSRS = <span class="keyword">None</span>, srcAlpha = <span class="keyword">False</span>, dstAlpha = <span class="keyword">False</span>, warpOptions = <span class="keyword">None</span>,</span><br><span class="line">				 errorThreshold = <span class="keyword">None</span>, warpMemoryLimit = <span class="keyword">None</span>, creationOptions = <span class="keyword">None</span>,</span><br><span class="line">				 outputType = GDT_Unknown, workingType = GDT_Unknown, resampleAlg = <span class="keyword">None</span>,</span><br><span class="line">                 srcNodata = <span class="keyword">None</span>, dstNodata = <span class="keyword">None</span>, multithread = <span class="keyword">False</span>, tps = <span class="keyword">False</span>,</span><br><span class="line">                 rpc = <span class="keyword">False</span>, geoloc = <span class="keyword">False</span>, polynomialOrder = <span class="keyword">None</span>,</span><br><span class="line">                 transformerOptions = <span class="keyword">None</span>, cutlineDSName = <span class="keyword">None</span>, cutlineLayer = <span class="keyword">None</span>,</span><br><span class="line">                 cutlineWhere = <span class="keyword">None</span>, cutlineSQL = <span class="keyword">None</span>, cutlineBlend = <span class="keyword">None</span>,</span><br><span class="line">                 ropToCutline = <span class="keyword">False</span>, copyMetadata = <span class="keyword">True</span>, metadataConflictValue = <span class="keyword">None</span>,</span><br><span class="line">                 setColorInterpretation = <span class="keyword">False</span>, callback = <span class="keyword">None</span>, callback_data = <span class="keyword">None</span>):</span><br><span class="line"><span class="comment"># options --- 字符串数组, 字符串或者空值</span></span><br><span class="line"><span class="comment"># format --- 输出格式 ("GTiff", etc...)</span></span><br><span class="line"><span class="comment"># outputBounds --- 结果在目标空间参考的边界范围(minX, minY, maxX, maxY)</span></span><br><span class="line"><span class="comment"># outputBoundsSRS --- 结果边界范围的空间参考, 如果在dstSRS中没有指定的话，采用此参数</span></span><br><span class="line"><span class="comment"># xRes, yRes --- 输出分辨率，即像素的大小</span></span><br><span class="line"><span class="comment"># targetAlignedPixels --- 是否强制输出边界是输出分辨率的倍数</span></span><br><span class="line"><span class="comment"># width --- 输出栅格的列数</span></span><br><span class="line"><span class="comment"># height --- 输出栅格的行数</span></span><br><span class="line"><span class="comment"># srcSRS --- 输入数据集的空间参考</span></span><br><span class="line"><span class="comment"># dstSRS --- 输出数据集的空间参考</span></span><br><span class="line"><span class="comment"># srcAlpha --- 是否将输入数据集的最后一个波段作为alpha波段</span></span><br><span class="line"><span class="comment"># dstAlpha --- 是否强制创建输出</span></span><br><span class="line"><span class="comment"># outputType --- 输出栅格的变量类型 (gdal.GDT_Byte, etc...)</span></span><br><span class="line"><span class="comment"># workingType --- working type (gdal.GDT_Byte, etc...)</span></span><br><span class="line"><span class="comment"># warpOptions --- list of warping options</span></span><br><span class="line"><span class="comment"># errorThreshold --- 近似转换的误差阈值(误差像素数目)</span></span><br><span class="line"><span class="comment"># warpMemoryLimit --- 工作内存限制 Bytes</span></span><br><span class="line"><span class="comment"># resampleAlg --- 重采样方法</span></span><br><span class="line"><span class="comment"># creationOptions --- list of creation options</span></span><br><span class="line"><span class="comment"># srcNodata --- 输入栅格的无效值</span></span><br><span class="line"><span class="comment"># dstNodata --- 输出栅格的无效值</span></span><br><span class="line"><span class="comment"># multithread --- 是否多线程和I/O操作</span></span><br><span class="line"><span class="comment"># tps --- 是否使用Thin Plate Spline校正方法</span></span><br><span class="line"><span class="comment"># rpc --- 是否使用RPC校正</span></span><br><span class="line"><span class="comment"># geoloc --- 是否使用地理查找表校正</span></span><br><span class="line"><span class="comment"># polynomialOrder --- 几何多项式校正次数</span></span><br><span class="line"><span class="comment"># transformerOptions --- list of transformer options</span></span><br><span class="line"><span class="comment"># cutlineDSName --- cutline数据集名称</span></span><br><span class="line"><span class="comment"># cutlineLayer --- cutline图层名称</span></span><br><span class="line"><span class="comment"># cutlineWhere --- cutline WHERE 子句</span></span><br><span class="line"><span class="comment"># cutlineSQL --- cutline SQL语句</span></span><br><span class="line"><span class="comment"># cutlineBlend --- cutline blend distance in pixels</span></span><br><span class="line"><span class="comment"># cropToCutline --- 是否使用切割线范围作为输出边界</span></span><br><span class="line"><span class="comment"># copyMetadata --- 是否复制元数据</span></span><br><span class="line"><span class="comment"># metadataConflictValue --- 元数据冲突值</span></span><br><span class="line"><span class="comment"># setColorInterpretation --- 是否强制将输入栅格颜色表给输出栅格</span></span><br><span class="line"><span class="comment"># callback --- 回调函数</span></span><br><span class="line"><span class="comment"># callback_data --- 用于回调的用户数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数很多，有些也没有试验过，有翻译不对的地方也请批评指正。</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;多项式校正和TPS校正利用上述流程即可校正，对于<strong>Geoloc校正</strong>，可以参考李老师博文<em>[5]</em> <em>[6]</em>中的思路，分为两种情况：</p>
<ul>
<li>对于自带GeoLocation元数据段的MODIS数据，利用<code>gdal.Info()</code>查看波段信息，直接利用<code>gdal.Warp()</code>设置<code>geoloc=True</code>后,对目标波段进行校正即可：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ds = gdal.Warp(<span class="string">r'X:\ModisNearest.tif'</span>,</span><br><span class="line">			   <span class="string">r'HDF4_EOS:EOS_SWATH:"X:\MOD021KM.A2018130.0220.061.2018130132414\MOD021KM.A2018130.0220.061.2018130132414.hdf":MODIS_SWATH_Type_L1B:EV_1KM_RefSB'</span>,</span><br><span class="line">			   width=<span class="number">2030</span>, height=<span class="number">1354</span>, format=<span class="string">'GTiff'</span>, geoloc=<span class="keyword">True</span>,</span><br><span class="line">			   dstSRS=sr.ExportToWkt(), resampleAlg=gdal.GRIORA_NearestNeighbour)</span><br></pre></td></tr></table></figure>
<ul>
<li>对于其他类型数据，则需要构造VRT文件，然后指定geoloc信息<em>[7]</em>，假设现在有一幅未校正图像 XXX.tif，还有 longitude.tif，latitude.tif 两个经纬度文件(写成一个文件也可以，只不过需要改 X_BAND 和  Y_BAND 的值)，于是我们构造一个 xxx.vrt 文件，内容如下：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">VRTDataset</span> <span class="attr">rasterXSize</span>=<span class="string">"60"</span> <span class="attr">rasterYSize</span>=<span class="string">"39"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Metadata</span> <span class="attr">domain</span>=<span class="string">"GEOLOCATION"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MDI</span> <span class="attr">key</span>=<span class="string">"SRS"</span>&gt;</span>GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9108"]],AXIS["Lat",NORTH],AXIS["Long",EAST],AUTHORITY["EPSG","4326"]]<span class="tag">&lt;/<span class="name">MDI</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MDI</span> <span class="attr">key</span>=<span class="string">"X_DATASET"</span>&gt;</span>X:\longitude.tif<span class="tag">&lt;/<span class="name">MDI</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MDI</span> <span class="attr">key</span>=<span class="string">"X_BAND"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">MDI</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MDI</span> <span class="attr">key</span>=<span class="string">"PIXEL_OFFSET"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">MDI</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MDI</span> <span class="attr">key</span>=<span class="string">"PIXEL_STEP"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">MDI</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MDI</span> <span class="attr">key</span>=<span class="string">"Y_DATASET"</span>&gt;</span>X:/latitude.tif<span class="tag">&lt;/<span class="name">MDI</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MDI</span> <span class="attr">key</span>=<span class="string">"Y_BAND"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">MDI</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MDI</span> <span class="attr">key</span>=<span class="string">"LINE_OFFSET"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">MDI</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MDI</span> <span class="attr">key</span>=<span class="string">"LINE_STEP"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">MDI</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Metadata</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">VRTRasterBand</span> <span class="attr">dataType</span>=<span class="string">"Int16"</span> <span class="attr">band</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ColorInterp</span>&gt;</span>Gray<span class="tag">&lt;/<span class="name">ColorInterp</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">NoDataValue</span>&gt;</span>65535<span class="tag">&lt;/<span class="name">NoDataValue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SimpleSource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">SourceFilename</span> <span class="attr">relativeToVRT</span>=<span class="string">"1"</span>&gt;</span>X:/XXX.tif<span class="tag">&lt;/<span class="name">SourceFilename</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">SourceBand</span>&gt;</span>3<span class="tag">&lt;/<span class="name">SourceBand</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">SrcRect</span> <span class="attr">xOff</span>=<span class="string">"0"</span> <span class="attr">yOff</span>=<span class="string">"0"</span> <span class="attr">xSize</span>=<span class="string">"100"</span> <span class="attr">ySize</span>=<span class="string">"100"</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">DstRect</span> <span class="attr">xOff</span>=<span class="string">"0"</span> <span class="attr">yOff</span>=<span class="string">"0"</span> <span class="attr">xSize</span>=<span class="string">"100"</span> <span class="attr">ySize</span>=<span class="string">"100"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">SimpleSource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">VRTRasterBand</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">VRTDataset</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;其中关键的是<code>&lt;Metadata&gt;</code>段中的9个key，其中<code>X_DATASET</code>和<code>Y_DATASET</code>指定了行列对应的经纬度波段，其他标签含义从略，可看参考资料。VRT文件后半部分的<code>&lt;SourceFilename&gt;</code>指定了需要校正的文件。<br>有了VRT文件，我们就可以进行校正了，输入改为vrt文件路径，<code>geoloc=True</code>用<code>Warp()</code>校正。</p>
<hr>
<p>&emsp;&emsp;关于RPC校正，我没有数据，没有测试过。。。但是经过一番搜索[8] ,看了里面gdal的单元测试文件，有如下思路以供参考:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rpc = [ <span class="string">"HEIGHT OFF=l09"</span>, <span class="string">"LINE NUM COEFF=-0. 001245683 -0. 09427649 -1. 006342 "</span></span><br><span class="line">        <span class="string">"-1. 954469e-05 0. 001033926 2.020534e-08 -3.845472e-07 一0.002075817 "</span></span><br><span class="line">        <span class="string">"0.0005520694 0 -4.642442e-06 -3.271793e-06 2. 705977e-05 -7.634384e-07 "</span></span><br><span class="line">        <span class="string">"-2.132832e-05 -3.248862e-05 -8.17894e-06 -3.678094e-07 2.002032e-06 "</span></span><br><span class="line">        <span class="string">"3.693162e-08"</span>, <span class="string">"LONG OFF=7.1477"</span></span><br><span class="line">        <span class="string">"SAMP DEN COEFF=l "</span> ......]</span><br><span class="line">ds.SetMetadata(rpc,<span class="string">'RPC'</span>)</span><br><span class="line">dst_ds = gdal.Warp(<span class="string">'output.xxx'</span>, ds, dstSRS=<span class="string">'EPSG:4326'</span>, xRes=<span class="number">0.0002</span>, yRes=<span class="number">0.0002</span>,</span><br><span class="line">					rpc=<span class="keyword">True</span>, transformerOptions = [<span class="string">r'RPC_DEM=X:\DEM.tif'</span>])</span><br></pre></td></tr></table></figure>
<h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><p>&emsp;&emsp;人生苦短，我用Python。</p>
<hr>
<p>参考资料<br>[1]：李民录. GDAL源码剖析与开发指南[M]. 人民邮电出版社, 2014.<br>[2]：<a href="https://blog.csdn.net/ivan_ljf/article/details/9226463" target="_blank" rel="noopener">https://blog.csdn.net/ivan_ljf/article/details/9226463</a> 关于GDAL计算图像坐标的几个问题<br>[3]：Garrad C. Geoprocessing with Python[M]. 2016.<br>[4]：<em>gdal.py</em>    Python gdal 包中定义代码<br>[5]：<a href="https://blog.csdn.net/liminlu0314/article/details/9181959" target="_blank" rel="noopener">https://blog.csdn.net/liminlu0314/article/details/9181959</a> 使用GDAL工具对FY3系列卫星数据进行校正<br>[6]：<a href="https://blog.csdn.net/liminlu0314/article/details/8623607" target="_blank" rel="noopener">https://blog.csdn.net/liminlu0314/article/details/8623607</a> 使用GDAL对HDF数据进行校正<br>[7]：<a href="https://stackoverflow.com/questions/50472624/reference-lat-lon-vrt-files-in-data-vrt-for-gdaltranslaste" target="_blank" rel="noopener">https://stackoverflow.com/questions/50472624/reference-lat-lon-vrt-files-in-data-vrt-for-gdaltranslaste</a> Reference Lat/Lon vrt files in data vrt for gdal translaste<br>[8]：<a href="https://svn.osgeo.org/gdal/" target="_blank" rel="noopener">https://svn.osgeo.org/gdal/</a>  这里面有gdal的单元测试文件</p>
<hr>

        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2018-10-18T14:57:47.292Z" itemprop="dateUpdated">2018-10-18 22:57:47</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/post/edf42ac0.html" target="_blank" rel="external">http://WilliamZcy.github.io/post/edf42ac0.html</a>
        
    </div>
    <footer>
        <a href="http://WilliamZcy.github.io">
            <img src="/img/face.jpg" alt="可乐&Mentos">
            可乐&Mentos
        </a>
    </footer>
</blockquote>

        
            <div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>

            
        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GDAL/">GDAL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://WilliamZcy.github.io/post/edf42ac0.html&title=《Python 利用GDAL对图像进行几何校正》 — Rhapsody&pic=http://WilliamZcy.github.io/img/face.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://WilliamZcy.github.io/post/edf42ac0.html&title=《Python 利用GDAL对图像进行几何校正》 — Rhapsody&source=
If the implementation is hard to explain, it’s a bad idea.If the implementat..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            
    <div id="comment"></div>



        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/post/f7d18982.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Hello</h4>
      </a>
    </div>
  

  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一、几何校正方法"><span class="post-toc-text">一、几何校正方法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二、转换关系的描述"><span class="post-toc-text">二、转换关系的描述</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三、Python中的GDAL几何校正"><span class="post-toc-text">三、Python中的GDAL几何校正</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-读取未经校正的图像"><span class="post-toc-text">1.读取未经校正的图像</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-构造地面控制点"><span class="post-toc-text">2.构造地面控制点</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-添加地面控制点到图像"><span class="post-toc-text">3.添加地面控制点到图像</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-进行校正"><span class="post-toc-text">4.进行校正</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#四、总结"><span class="post-toc-text">四、总结</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

    <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        最近打算存点私房钱，吃点好的，比如黄焖鸡米饭
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

    

</div>

        <footer class="footer">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://WilliamZcy.github.io" target="_blank">HOME</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                可乐&Mentos &copy; 2018
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://WilliamZcy.github.io/post/edf42ac0.html&title=《Python 利用GDAL对图像进行几何校正》 — Rhapsody&pic=http://WilliamZcy.github.io/img/face.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://WilliamZcy.github.io/post/edf42ac0.html&title=《Python 利用GDAL对图像进行几何校正》 — Rhapsody&source=
If the implementation is hard to explain, it’s a bad idea.If the implementat..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACPUlEQVR42u3awY7CMAxFUf7/pzvSrJAg4T67g6bu7QqhUnK6sPJiPx74On6v58/P37zes3/O69P2Tz7tkiFDxmUZx/ba//3qm/1y9wDyzDdUGTJk3IDBiyxf3P63pOCStcmQIUNG557aomXIkCHjOwweR2XIkCGDM3gEJUsnhbj2zBOyuAwZMi7IqDUGvvP5z/sbMmTI+PeMI7zi7Ro4dCPHcx9WJUOGjNGM9A/SP+uHVTKuIUOGjNmMzkEb2USSIQzypj+sU4YMGTdgkAOs9DiMtwpS9pvPMmTIGM3gD6q1HklLgDwTvW4ZMmSMZuwxtU0eb1Wm4Rb1Y2XIkDGI0Rnb4iW1M7qBxjVkyJBxG8a5BTctxGlUXp4aypAhYxyDAM5tZKZNheAlypAhYyijM/TQj6ydJsSyvyFDhoyhjH6w5INlaaBFG1AZMmSMZvD4mjY4+42B/auJd7gyZMi4LKNTIvnf84GwYkiWIUPGbRhpAe2MgtUO45a/lSFDxmjGvvCRANmPoOnWMAixMmTIGME4q9HIA2e6DUVtAxkyZNyMUQuftTja2VAud7gyZMgYx+gUu30R7MTUWoSWIUPGVMYRXrzBmSI798iQIWM2oxNcSXnlhXi/XHKnDBkyZjOKw1gnFcE0rKL4KkOGjKEMdAQfxtR+m5OvVoYMGTLS4Yl0Z8q3hsWZERkyZNyMwYspb3mmCXvZj5UhQ8ZoBg+xfEiCLI6PWQSTIzJkyBjHqEXHWhkli06RMmTIGM34Ac04RrzAbqHEAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.3.2"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.3.2"></script>
<script type="text/javascript" src="/js/blog.js?v=1.3.2"></script>

<!-- third-party -->







<script type="text/javascript" src="/js/plugins/local_search.js?v=1.3.2"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
        <script type="text/javascript" src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script type="text/javascript" src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script type="text/javascript" src="/js/plugins/valine.js?v=1.3.2"></script>
    
    



<script type="text/javascript" src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
<script type="text/javascript" src="/js/plugins/leancloud_visitors.js?v=1.3.2"></script>



    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>






    <script type="text/javascript">
  daovoice('init', {
    app_id: "bae606f1"
  });
  daovoice('update');
</script>


    
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
